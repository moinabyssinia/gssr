<html>
<head>
  <title> Surge Webmap</title>
  <!-- adding favicon -->
  <link rel="icon" type="image/png" href="https://img.icons8.com/color/32/000000/tsunami.png">
  <!-- mt: new version of bootstrap cdn -->
  
  <script src="./leaflet/leaflet.js"></script>
  <script src="jquery-2.1.1.min.js"></script> 

  <style>
    
    body {
      background-color:rgb(236, 230, 230);
    }
    #map{ 
      height: 75%;
      width: 65%; 
      position: relative;
      top: 3%;
      bottom: 10%;
      left: 17.5%;
      right: 17.5%;
    }
    
    .starter {
      margin-top: 5px;
      padding-top: 5px;
      font-size: 1.25em;
      color:darkred;
      text-align: center;
    }

    h2, h3, h4 {
      margin-bottom: 0px;
    }


    #eraint {
      color: blueviolet;
    }
    #era20c {
      color: brown;
    }
    #twcr {
      color: green;
    }

    .leaflet-bar a {
      background-color: #fff;
      border-bottom: 1px solid #ccc;
      /* border-bottom-color: rgb(204, 204, 204); */
      color: #444;
      display: block;
      height: 26px;
      width: 26px;
      line-height: 1.45 !important;
      text-align: center;
      text-decoration: none;
      font: bold 18px'Lucida Console', Monaco, monospace;
    }



  </style>

</head>
<body>

  <link rel="stylesheet" href="./leaflet/leaflet.css" />
  <link rel="stylesheet" type="text/css" href="webmap.css">
  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" 
  integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">




  <div class="starter">
    <h1>Global Storm Surge Database for the 20th Century </h1>
    <hr>
  </div>

  <div id="map"></div>

  <div class="info">
    <p>The methodology for this study builds on what is implemented by <a href="https://www.frontiersin.org/articles/10.3389/fmars.2020.00260/full" target="_blank">(Tadesse et al., 2020).</a> 
      Before the storm surge reconstruction, sensitivity analysis is carried out in two phases. 
      The first phase deals with predictor selection. Tadesse (2020) used five predictors (10 m 
      zonal and meridional wind speed, mean-sea level pressure, precipitation, and sea surface temperature). 
      In the first phase of the sensitivity analysis, multiple linear regression and random forest models are 
      trained for 841 tide gauges with different combinations of predictors and the simulated surge 
      is validated against observed surge. Eventually, 
      the combination of predictors that give the best validation result 
      (lowest RMSE and highest correlation) is chosen for further analysis.</p> 
      
      <p>In this study, we found that three predictors, viz. 10 m zonal and meridional wind speed and mean-sea level pressure give the best 
        validation results. Adding precipitation and sea surface temperature resulted in very little improvement on model accuracy and, hence 
        not used for further analysis. </p> 
      
      <p>The second phase of the sensitivity analysis deals with finding the optimal area around tide gauges that needs to be considered 
        to train/test the storm surge model. Tadesse (2020) used a 10 x 10 area around every tide gauge to train/test models.  
        Considering the high spatial and temporal resolution reanalyzes that are used for this study, it is imperative to find an optimal
         area around a tide gauge that reconciles the tradeoff between model accuracy and computation time. 
         To this end, a box of 1 x 1, 2 x 2, 3 x 3, 4 x 4, 6 x 6, and 8 x 8 were tested and results 
         were compared to the base case, 100 x 100. We found out that an area of  6 x 6  is optimal considering
          model accuracy(measured in RMSE and correlation) and computational time (measured in hours.) 
       </p>
      <p>
        Here we present a storm surge reconstruction produced by forcing the model presented by Tadesse (2020) 
        with <a href="https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era-interim">ERA-Interim global atmospheric reanalysis</a>,
        <a href="https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era-20c">ERA-20C global atmospheric reanalysis</a>, and 
        <a href="https://www.esrl.noaa.gov/psd/data/gridded/data.20thC_ReanV3.monolevel.html">20CRV3 (NOAA-CIRES) monolovel variables</a>.
      </p>

  </div>

  <script>

  // initialize the map
  // in the setView the first two values are lat and lon
  // the last number is the level of zoom
  var map = L.map('map', {
    zoomDelta: 0.5,
    zoomControl: false
    //maxBounds: bounds,
    //maxBoundsViscosity: 0.0
  }).setView([20, 0], 2);


  // load a tile layer
  L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    // maxZoom = 18,
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',

  }).addTo(map);

  
    // custom zoom bar control that includes a Zoom Home function
  L.Control.zoomHome = L.Control.extend({
      options: {
          position: 'topright',
          zoomInText: '+',
          zoomInTitle: 'Zoom in',
          zoomOutText: '-',
          zoomOutTitle: 'Zoom out',
          zoomHomeText: '<i class="fas fa-home" style="line-height:1.65;"></i>',
          zoomHomeTitle: 'Zoom home'
      },

      onAdd: function (map) {
          var controlName = 'gin-control-zoom',
              container = L.DomUtil.create('div', controlName + ' leaflet-bar'),
              options = this.options;

          this._zoomInButton = this._createButton(options.zoomInText, options.zoomInTitle,
          controlName + '-in', container, this._zoomIn);
          this._zoomHomeButton = this._createButton(options.zoomHomeText, options.zoomHomeTitle,
          controlName + '-home', container, this._zoomHome);
          this._zoomOutButton = this._createButton(options.zoomOutText, options.zoomOutTitle,
          controlName + '-out', container, this._zoomOut);

          this._updateDisabled();
          map.on('zoomend zoomlevelschange', this._updateDisabled, this);

          return container;
      },

      onRemove: function (map) {
          map.off('zoomend zoomlevelschange', this._updateDisabled, this);
      },

      _zoomIn: function (e) {
          this._map.zoomIn(e.shiftKey ? 3 : 1);
      },

      _zoomOut: function (e) {
          this._map.zoomOut(e.shiftKey ? 3 : 1);
      },

      _zoomHome: function (e) {
          map.setView([20, 0], 2);
      },

      _createButton: function (html, title, className, container, fn) {
          var link = L.DomUtil.create('a', className, container);
          link.innerHTML = html;
          link.href = '#';
          link.title = title;

          L.DomEvent.on(link, 'mousedown dblclick', L.DomEvent.stopPropagation)
              .on(link, 'click', L.DomEvent.stop)
              .on(link, 'click', fn, this)
              .on(link, 'click', this._refocusOnMap, this);

          return link;
      },

      _updateDisabled: function () {
          var map = this._map,
              className = 'leaflet-disabled';

          L.DomUtil.removeClass(this._zoomInButton, className);
          L.DomUtil.removeClass(this._zoomOutButton, className);

          if (map._zoom === map.getMinZoom()) {
              L.DomUtil.addClass(this._zoomOutButton, className);
          }
          if (map._zoom === map.getMaxZoom()) {
              L.DomUtil.addClass(this._zoomInButton, className);
          }
      }
  });
  // add the new control to the map
  var zoomHome = new L.Control.zoomHome();
  zoomHome.addTo(map);







  // load GeoJSON from an external file
  $.getJSON("twCR_Era20c_EraIntData.geojson",function(data){
    var surgeIcon = L.icon({
      iconUrl: 'circle-48.png',
      iconSize: [13, 13], // size of the icon
    });
    
    // add GeoJSON layer to the map once the file is loaded
    L.geoJson(data, {
      pointToLayer: function(feature,latlng){
        var marker = L.marker(latlng,{icon: surgeIcon});
        marker.bindPopup( "<h2>Station Metadata:</h2>" + '<hr/>' +  "<h4>Station Name:</h4>  "  
        +feature.properties.tg + '<br/>' + "<h4>Lon/Lat:</h4>  "+ '[' +feature.properties.lon + ', ' + 
        feature.properties.lat +  ']' +'<hr/>' + 
        
          // ERA-Int
         '<a href= ' + feature.properties.eraintPath + '><h4>Daily Max Surge [CSV]</h4></a>' + 
         "<h4>Model Forcing:</h4>  " + "<span id = 'eraint'>ERA-Interim</span>  - " + feature.properties.yrEraint + " years" + '<br/>' + 
         '<hr/>' +
         
          // ERA20C
         '<a href= ' + feature.properties.era20cPath + '><h4>Daily Max Surge [CSV]</h4></a>' + 
         "<h4>Model Forcing:</h4>  " + "<span id = 'era20c'>ERA-20C</span>  - " + feature.properties.yrEra20c + " years" + '<br/>' +
         '<hr/>' +
         
        //  20thCR
         '<a href= ' + feature.properties.twcrPath + '><h4>Daily Max Surge [CSV]</h4></a>' +
         "<h4>Model Forcing:</h4>  " + "<span id = 'twcr'>20thCR</span>  - " + feature.properties.yrTwcr + " years" + '<br/>'
         );
        return marker;
      }
    }).addTo(map);
  });
 

  </script>
</body>
</html>